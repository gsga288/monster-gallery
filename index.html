<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>å¡ç‰Œå¼å® ç‰©å±•ç¤º</title>
  <style>
    /* æ•´ä½“å±…ä¸­ï¼Œæ·±è‰²èƒŒæ™¯ */
    body, html {
      margin: 0; padding: 0;
      background: #111;
      font-family: "å¾®è½¯é›…é»‘", sans-serif;
      color: #eee;
      display: flex; flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    /* å¡ç‰Œå®¹å™¨ */
    .card {
      width: 80vw; max-width: 500px;
      background: #222;
      border: 2px solid #444;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      overflow: hidden;
      display: flex; flex-direction: column;
    }
    /* å¤´éƒ¨ï¼šåå­— + ç¨€æœ‰åº¦ */
    .card-header {
      display: flex; justify-content: space-between;
      padding: 8px 12px;
      background: #333;
      border-bottom: 1px solid #444;
    }
    .pet-name {
      font-size: 1.2em;
      font-weight: bold;
    }
    .pet-rarity {
      font-size: 1.2em;
      padding: 2px 6px;
      border-radius: 4px;
      background: gold;
      color: #111;
    }
    /* åª’ä½“åŒºåŸŸ */
    #media-container {
      background: #000;
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 */
      position: relative;
    }
    #media-container video,
    #media-container img {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: contain;
      background: #000;
    }
    /* ä»‹ç» */
    .pet-desc {
      padding: 12px;
      line-height: 1.4;
      font-size: 0.95em;
      flex-grow: 1;
    }
    /* â€œå†æ¥ä¸€æ¬¡â€æŒ‰é’® */
    #reload {
      margin: 16px;
      padding: 8px 16px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background: #28a;
      color: #fff;
      cursor: pointer;
    }
    #reload:hover {
      background: #39b;
    }
  </style>
</head>
<body>

  <div class="card">
    <div class="card-header">
      <div class="pet-name" id="pet-name">åŠ è½½ä¸­â€¦</div>
      <div class="pet-rarity" id="pet-rarity">â€“</div>
    </div>
    <div id="media-container"></div>
    <div class="pet-desc" id="pet-desc">â€”â€”</div>
  </div>

  <button id="reload">ğŸ”„ å†æ¥ä¸€æ¬¡</button>

  <script>
  // â€”â€” 1. éšæœºç”Ÿæˆå››ä¸ªå‚æ•° â€”â€” 
  function randomInt(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
  }
  function genParams(){
    return {
      heart: randomInt(60,100),
      touch: randomInt(0,50),
      sound: randomInt(0,120),
      time:  randomInt(0,100)
    };
  }

  // â€”â€” 2. äºŒå€¼åŒ– & åˆ†ç±» â€”â€” 
  function toBit(val,thr){ return val>thr?'1':'0'; }
  function categorize(p){
    const b0 = toBit(p.heart,80);
    const b1 = toBit(p.touch,25);
    const b2 = toBit(p.sound,80);
    const b3 = toBit(p.time,30);
    return b0+b1+b2+b3;
  }

  // â€”â€” 3. æ ¹æ®â€œ1â€çš„æ•°é‡ç®—ç¨€æœ‰åº¦ â€”â€” 
  function getRarity(code){
    const ones = code.split('').filter(c=>c==='1').length;
    return ['D','C','B','A','S'][ones];
  }

  // â€”â€” 4. é¢„è®¾ 16 ç±»å® ç‰©ï¼ˆç¤ºä¾‹ï¼‰â€”â€” 
  // æ³¨æ„ï¼šåŠ¡å¿…å’Œä½ çš„ media/ ç›®å½•ç»“æ„ & æ–‡ä»¶å **å®Œå…¨ä¸€è‡´**ï¼ˆåŒ…æ‹¬å¤§å°å†™ï¼‰
  const PET_MAP = {
    "0000":[
      {
        src: "media/calm_friendly_relaxed_cautious/blue.mp4",
        name: "å¹½è“æ°´æ¯",
        desc: "ä¸€åªæ–‡é™çš„æ°´æ¯å® ç‰©ï¼Œè½»æŸ”åœ°åœ¨æ·±æµ·ä¸­æ¼‚æµ®ã€‚"
      }
    ],
    "0001":[
      {
        src: "media/calm_friendly_relaxed_loving/blue.mp4",
        name: "ä¾ä¾è“é²¸",
        desc: "äº²è¿‘ä¸»äººï¼Œæ¸©é¡ºåœ°åœ¨ä½ èº«è¾¹æ¸¸åŠ¨å¹¶å‘å‡ºå‘¼å™œå£°ã€‚"
      }
    ],
    "0010":[
      {
        src: "media/calm_friendly_alert_cautious/blue.mp4",
        name: "è­¦è§‰æ°´æ¯",
        desc: "æ”¾æ¾ä½†å¾®å¾®è­¦æƒ•ï¼Œè€³æœµç«–èµ·ï¼Œéšæ—¶è§‚å¯Ÿå››å‘¨ã€‚"
      }
    ],
    "0011":[
      {
        src: "media/calm_friendly_alert_loving/blue.mp4",
        name: "å‡è§†è“é²¸",
        desc: "è­¦è§‰ä¾ç„¶å­˜åœ¨ï¼Œå´ä¹Ÿæ¸´æœ›ä¸»äººçš„æŠšæ‘¸ä¸é™ªä¼´ã€‚"
      }
    ],
    "0100":[
      {
        src: "media/calm_reserved_relaxed_cautious/blue.mp4",
        name: "æ·¡æ³Šæ°´æ¯",
        desc: "ä¿æŒè·ç¦»å´å®‰é™åœ°æ¼‚æµ®ï¼Œä¸è½»æ˜“é è¿‘ã€‚"
      }
    ],
    "0101":[
      {
        src: "media/calm_reserved_relaxed_loving/blue.mp4",
        name: "åŠä¿¡åŠç–‘",
        desc: "å¯¹ä¸»äººç•¥æœ‰ä¿¡ä»»ï¼Œä½†ä»æ—§ä¿æŒå¾®å°è·ç¦»ã€‚"
      }
    ],
    "0110":[
      {
        src: "media/calm_reserved_alert_cautious/blue.mp4",
        name: "è­¦æˆ’æ°´æ¯",
        desc: "æ”¾æ¾çŠ¶æ€ä¸‹å´é«˜åº¦è­¦è§‰ï¼Œè€³æœµä½å‚ã€‚"
      }
    ],
    "0111":[
      {
        src: "media/calm_reserved_alert_loving/blue.mp4",
        name: "çŸ›ç›¾ä¹‹è“",
        desc: "è­¦æƒ•åˆæ¸´æœ›ï¼Œæ—¶è€Œç¼©å¤´ï¼Œæ—¶è€Œæ¢èº«ã€‚"
      }
    ],
    "1000":[
      {
        src: "media/excited_friendly_relaxed_cautious/blue.mp4",
        name: "è·ƒåŠ¨æ°´æ¯",
        desc: "å…´å¥‹å´æœ‰äº›è°¨æ…ï¼Œèº«ä½“å¿«é€ŸæŒ¯åŠ¨ã€‚"
      }
    ],
    "1001":[
      {
        src: "media/excited_friendly_relaxed_loving/creature2.png",
        name: "ç”œèœœæ°´æ™¶",
        desc: "æ´»åŠ›å››å°„ï¼Œå´äº²æ˜µä¾ååœ¨ä½ èº«è¾¹ã€‚"
      }
    ],
    "1010":[
      {
        src: "media/excited_friendly_alert_cautious/blue.mp4",
        name: "æ¿€æ˜‚å®ˆæŠ¤è€…",
        desc: "å…´å¥‹ä¸”è­¦è§‰ï¼Œå‡†å¤‡ä¸ºä½ ä¿é©¾æŠ¤èˆªã€‚"
      }
    ],
    "1011":[
      {
        src: "media/excited_friendly_alert_loving/creature2.png",
        name: "ç‡ƒæƒ…çœ·æ‹",
        desc: "çƒ­æƒ…ä¸è­¦æƒ•å¹¶å­˜ï¼Œå¯¹ä½ å¿ƒå­˜çˆ±æ„ã€‚"
      }
    ],
    "1100":[
      {
        src: "media/excited_reserved_relaxed_cautious/creature2.png",
        name: "æ‹˜è°¨æ˜Ÿå°˜",
        desc: "å¤–è¡¨å…´å¥‹ï¼Œå†…å¿ƒå´ä¿æŒä¸€ä¸è·ç¦»ã€‚"
      }
    ],
    "1101":[
      {
        src: "media/excited_reserved_relaxed_loving/creature2.png",
        name: "å«è“„æŒšçˆ±",
        desc: "æ²‰é™ä¸­æš—è—çƒ­æƒ…ï¼Œå¶å°”ç”¨çœ¼ç¥ç¤ºå¥½ã€‚"
      }
    ],
    "1110":[
      {
        src: "media/excited_reserved_alert_cautious/creature2.png",
        name: "è°¨æ…ä¹‹ç„°",
        desc: "æ¿€æƒ…ä¸è­¦æƒ•é½é£ï¼Œä¸è½»æ˜“è¡¨éœ²ã€‚"
      }
    ],
    "1111":[
      {
        src: "media/excited_reserved_alert_loving/creature2.png",
        name: "æè‡´ä¾æ‹",
        desc: "çƒ­æƒ…ã€è­¦æƒ•ã€æ·±æƒ…ï¼Œå®Œç¾äº¤ç»‡äºä¸€èº«ã€‚"
      }
    ]
  };

  // â€”â€” 5. æ¸²æŸ“å‡½æ•° â€”â€” 
  function renderCard(){
    // 5.1 éšæœºå‚ & åˆ†ç±»
    const p = genParams();
    const cat = categorize(p);
    const rarity = getRarity(cat);

    // 5.2 å–å‡ºè¿™ä¸€ç±»çš„åˆ—è¡¨ & éšæœºæŒ‘ä¸€ä¸ª
    const arr = PET_MAP[cat] || [];
    if(!arr.length){
      console.error("ç±»åˆ«",cat,"æ²¡æœ‰é…ç½®ä»»ä½•å® ç‰©ï¼");
      return;
    }
    const pet = arr[Math.floor(Math.random()*arr.length)];

    // 5.3 å¡«å€¼ â€”â€” åå­— / ç¨€æœ‰åº¦ / æè¿°
    document.getElementById('pet-name').textContent   = pet.name;
    document.getElementById('pet-rarity').textContent = rarity;
    document.getElementById('pet-desc').textContent   = pet.desc;

    // 5.4 åŠ è½½åª’ä½“
    const container = document.getElementById('media-container');
    container.innerHTML = '';
    if(pet.src.endsWith('.mp4')){
      const v = document.createElement('video');
      v.src            = pet.src;
      v.autoplay       = true;
      v.loop           = true;
      v.muted          = true;
      v.preload        = 'auto';
      v.playsInline    = true;
      v.setAttribute('playsinline','');
      v.setAttribute('webkit-playsinline','');
      v.addEventListener('loadedmetadata',()=>v.play().catch(()=>{}));
      container.appendChild(v);
    } else {
      const img = document.createElement('img');
      img.src = pet.src;
      container.appendChild(img);
    }
  }

  // â€”â€” 6. ç»‘å®š & åˆå§‹æ¸²æŸ“ â€”â€” 
  document.getElementById('reload')
    .addEventListener('click', renderCard);
  renderCard();

  </script>
</body>
</html>
