<!-- index.html -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>生命游戏：随机飞船</title>
  <style>
    /* 全屏黑底，画布居中 */
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #fff;
      font-family: sans-serif;
    }
    canvas {
      box-shadow: 0 0 10px rgba(0,255,0,0.5);
    }
    #info {
      position: absolute;
      top: 10px; left: 10px;
      background: rgba(0,0,0,0.5);
      padding: 5px 10px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="info">Pattern: <span id="patternName"></span></div>
  <canvas id="game"></canvas>

  <script>
  // —— 参数配置 ——
  const CELL_SIZE = 4;        // 每个细胞像素大小
  const COLS      = 150;      // 网格宽度
  const ROWS      = 100;      // 网格高度
  const TICK_MS   = 100;      // 演化间隔（毫秒）

  // —— 飞船样式定义 —— 相对 (0,0) 坐标的存活细胞列表
  const PATTERNS = [
    {
      name: "Glider (滑翔机)",
      w: 3, h: 3,
      cells: [
        [1,0],[2,1],[0,2],[1,2],[2,2]
      ]
    },
    {
      name: "Lightweight Spaceship (轻型飞船)",
      w: 5, h: 4,
      cells: [
        [1,0],[2,0],[3,0],[4,0],
        [0,1],[4,1],
        [4,2],
        [0,3],[3,3]
      ]
    },
    {
      name: "Middleweight Spaceship",
      w: 6, h: 4,
      cells: [
        [2,0],[3,0],[4,0],[5,0],
        [0,1],[5,1],
        [5,2],
        [0,3],[4,3]
      ]
    }
    // 若要更多，可自行按生命游戏标准格式追加
  ];

  // —— 初始化画布和网格数据 —— 
  const canvas = document.getElementById("game");
  const ctx    = canvas.getContext("2d");
  canvas.width  = COLS * CELL_SIZE;
  canvas.height = ROWS * CELL_SIZE;

  let grid    = Array.from({length: ROWS}, () => Array(COLS).fill(0));
  let newGrid = Array.from({length: ROWS}, () => Array(COLS).fill(0));

  // —— 随机选择一个飞船、将它放到中央 —— 
  function seedRandomPattern() {
    // 清空
    for (let y=0; y<ROWS; y++) grid[y].fill(0);

    const p = PATTERNS[Math.floor(Math.random() * PATTERNS.length)];
    document.getElementById("patternName").textContent = p.name;
    const offsetX = Math.floor((COLS - p.w) / 2);
    const offsetY = Math.floor((ROWS - p.h) / 2);

    p.cells.forEach(([dx,dy]) => {
      grid[offsetY + dy][offsetX + dx] = 1;
    });
  }

  // —— 绘制网格 —— 
  function draw() {
    ctx.fillStyle = "#111";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#0f0";
    for (let y=0; y<ROWS; y++){
      for (let x=0; x<COLS; x++){
        if (grid[y][x]) {
          ctx.fillRect(
            x*CELL_SIZE,
            y*CELL_SIZE,
            CELL_SIZE,
            CELL_SIZE
          );
        }
      }
    }
  }

  // —— 演化一步 —— 
  function step() {
    for (let y=0; y<ROWS; y++){
      for (let x=0; x<COLS; x++){
        // 计算 8 邻居活细胞数
        let n = 0;
        for (let dy=-1; dy<=1; dy++){
          for (let dx=-1; dx<=1; dx++){
            if (dx || dy) {
              const yy = (y + dy + ROWS) % ROWS;
              const xx = (x + dx + COLS) % COLS;
              n += grid[yy][xx];
            }
          }
        }
        // 生命游戏规则
        newGrid[y][x] = (n === 3 || (grid[y][x] && n === 2)) ? 1 : 0;
      }
    }
    // 交换引用
    [grid, newGrid] = [newGrid, grid];
  }

  // —— 入口 —— 
  seedRandomPattern();
  draw();
  setInterval(() => {
    step();
    draw();
  }, TICK_MS);
  </script>
</body>
</html>
