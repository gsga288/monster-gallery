<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>卡牌式宠物展示</title>
  <style>
    /* 整体居中，深色背景 */
    body, html {
      margin: 0; padding: 0;
      background: #111;
      font-family: "微软雅黑", sans-serif;
      color: #eee;
      display: flex; flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    /* 卡牌容器 */
    .card {
      width: 80vw; max-width: 500px;
      background: #222;
      border: 2px solid #444;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      overflow: hidden;
      display: flex; flex-direction: column;
    }
    /* 头部：名字 + 稀有度 */
    .card-header {
      display: flex; justify-content: space-between;
      padding: 8px 12px;
      background: #333;
      border-bottom: 1px solid #444;
    }
    .pet-name {
      font-size: 1.2em;
      font-weight: bold;
    }
    .pet-rarity {
      font-size: 1.2em;
      padding: 2px 6px;
      border-radius: 4px;
      background: gold;
      color: #111;
    }
    /* 媒体区域 */
    #media-container {
      background: #000;
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 */
      position: relative;
    }
    #media-container video,
    #media-container img {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: contain;
      background: #000;
    }
    /* 介绍 */
    .pet-desc {
      padding: 12px;
      line-height: 1.4;
      font-size: 0.95em;
      flex-grow: 1;
    }
    /* “再来一次”按钮 */
    #reload {
      margin: 16px;
      padding: 8px 16px;
      font-size: 1em;
      border: none;
      border-radius: 4px;
      background: #28a;
      color: #fff;
      cursor: pointer;
    }
    #reload:hover {
      background: #39b;
    }
  </style>
</head>
<body>

  <div class="card">
    <div class="card-header">
      <div class="pet-name" id="pet-name">加载中…</div>
      <div class="pet-rarity" id="pet-rarity">–</div>
    </div>
    <div id="media-container"></div>
    <div class="pet-desc" id="pet-desc">——</div>
  </div>

  <button id="reload">🔄 再来一次</button>

  <script>
  // —— 1. 随机生成四个参数 —— 
  function randomInt(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
  }
  function genParams(){
    return {
      heart: randomInt(60,100),
      touch: randomInt(0,50),
      sound: randomInt(0,120),
      time:  randomInt(0,100)
    };
  }

  // —— 2. 二值化 & 分类 —— 
  function toBit(val,thr){ return val>thr?'1':'0'; }
  function categorize(p){
    const b0 = toBit(p.heart,80);
    const b1 = toBit(p.touch,25);
    const b2 = toBit(p.sound,80);
    const b3 = toBit(p.time,30);
    return b0+b1+b2+b3;
  }

  // —— 3. 根据“1”的数量算稀有度 —— 
  function getRarity(code){
    const ones = code.split('').filter(c=>c==='1').length;
    return ['D','C','B','A','S'][ones];
  }

  // —— 4. 预设 16 类宠物（示例）—— 
  // 注意：务必和你的 media/ 目录结构 & 文件名 **完全一致**（包括大小写）
  const PET_MAP = {
    "0000":[
      {
        src: "media/calm_friendly_relaxed_cautious/blue.mp4",
        name: "幽蓝水母",
        desc: "一只文静的水母宠物，轻柔地在深海中漂浮。"
      }
    ],
    "0001":[
      {
        src: "media/calm_friendly_relaxed_loving/blue.mp4",
        name: "依依蓝鲸",
        desc: "亲近主人，温顺地在你身边游动并发出呼噜声。"
      }
    ],
    "0010":[
      {
        src: "media/calm_friendly_alert_cautious/blue.mp4",
        name: "警觉水母",
        desc: "放松但微微警惕，耳朵竖起，随时观察四周。"
      }
    ],
    "0011":[
      {
        src: "media/calm_friendly_alert_loving/blue.mp4",
        name: "凝视蓝鲸",
        desc: "警觉依然存在，却也渴望主人的抚摸与陪伴。"
      }
    ],
    "0100":[
      {
        src: "media/calm_reserved_relaxed_cautious/blue.mp4",
        name: "淡泊水母",
        desc: "保持距离却安静地漂浮，不轻易靠近。"
      }
    ],
    "0101":[
      {
        src: "media/calm_reserved_relaxed_loving/blue.mp4",
        name: "半信半疑",
        desc: "对主人略有信任，但仍旧保持微小距离。"
      }
    ],
    "0110":[
      {
        src: "media/calm_reserved_alert_cautious/blue.mp4",
        name: "警戒水母",
        desc: "放松状态下却高度警觉，耳朵低垂。"
      }
    ],
    "0111":[
      {
        src: "media/calm_reserved_alert_loving/blue.mp4",
        name: "矛盾之蓝",
        desc: "警惕又渴望，时而缩头，时而探身。"
      }
    ],
    "1000":[
      {
        src: "media/excited_friendly_relaxed_cautious/blue.mp4",
        name: "跃动水母",
        desc: "兴奋却有些谨慎，身体快速振动。"
      }
    ],
    "1001":[
      {
        src: "media/excited_friendly_relaxed_loving/creature2.png",
        name: "甜蜜水晶",
        desc: "活力四射，却亲昵依偎在你身边。"
      }
    ],
    "1010":[
      {
        src: "media/excited_friendly_alert_cautious/blue.mp4",
        name: "激昂守护者",
        desc: "兴奋且警觉，准备为你保驾护航。"
      }
    ],
    "1011":[
      {
        src: "media/excited_friendly_alert_loving/creature2.png",
        name: "燃情眷恋",
        desc: "热情与警惕并存，对你心存爱意。"
      }
    ],
    "1100":[
      {
        src: "media/excited_reserved_relaxed_cautious/creature2.png",
        name: "拘谨星尘",
        desc: "外表兴奋，内心却保持一丝距离。"
      }
    ],
    "1101":[
      {
        src: "media/excited_reserved_relaxed_loving/creature2.png",
        name: "含蓄挚爱",
        desc: "沉静中暗藏热情，偶尔用眼神示好。"
      }
    ],
    "1110":[
      {
        src: "media/excited_reserved_alert_cautious/creature2.png",
        name: "谨慎之焰",
        desc: "激情与警惕齐飞，不轻易表露。"
      }
    ],
    "1111":[
      {
        src: "media/excited_reserved_alert_loving/creature2.png",
        name: "极致依恋",
        desc: "热情、警惕、深情，完美交织于一身。"
      }
    ]
  };

  // —— 5. 渲染函数 —— 
  function renderCard(){
    // 5.1 随机参 & 分类
    const p = genParams();
    const cat = categorize(p);
    const rarity = getRarity(cat);

    // 5.2 取出这一类的列表 & 随机挑一个
    const arr = PET_MAP[cat] || [];
    if(!arr.length){
      console.error("类别",cat,"没有配置任何宠物！");
      return;
    }
    const pet = arr[Math.floor(Math.random()*arr.length)];

    // 5.3 填值 —— 名字 / 稀有度 / 描述
    document.getElementById('pet-name').textContent   = pet.name;
    document.getElementById('pet-rarity').textContent = rarity;
    document.getElementById('pet-desc').textContent   = pet.desc;

    // 5.4 加载媒体
    const container = document.getElementById('media-container');
    container.innerHTML = '';
    if(pet.src.endsWith('.mp4')){
      const v = document.createElement('video');
      v.src            = pet.src;
      v.autoplay       = true;
      v.loop           = true;
      v.muted          = true;
      v.preload        = 'auto';
      v.playsInline    = true;
      v.setAttribute('playsinline','');
      v.setAttribute('webkit-playsinline','');
      v.addEventListener('loadedmetadata',()=>v.play().catch(()=>{}));
      container.appendChild(v);
    } else {
      const img = document.createElement('img');
      img.src = pet.src;
      container.appendChild(img);
    }
  }

  // —— 6. 绑定 & 初始渲染 —— 
  document.getElementById('reload')
    .addEventListener('click', renderCard);
  renderCard();

  </script>
</body>
</html>
