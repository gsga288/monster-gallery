<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pet Card Display</title>
  <style>
    /* 全页背景 */
    body, html {
      margin: 0; padding: 0;
      background: url('wonderland.png') no-repeat center center fixed;
      background-size: cover;
      font-family: sans-serif;
      color: #eee;
      display: flex; justify-content: center; align-items: center;
      height: 100vh;
    }
    /* 卡牌容器 */
    .card {
      width: 80vw; max-width: 500px;
      background: rgba(34,34,34,0.9);
      border: 2px solid #444;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.6);
      overflow: hidden;
      display: flex; flex-direction: column;
    }
    /* Header：name + rarity */
    .card-header {
      display: flex; justify-content: space-between;
      padding: 8px 12px;
      background: #333;
      border-bottom: 1px solid #444;
    }
    .pet-name {
      font-size: 1.2em; font-weight: bold;
    }
    .pet-rarity {
      font-size: 1.2em;
      padding: 2px 6px;
      border-radius: 4px;
      background: gold; color: #111;
    }
    /* Params: only English */
    .card-params {
      padding: 8px 12px;
      background: #2a2a2a;
      border-bottom: 1px solid #444;
      display: flex; justify-content: space-around;
      font-size: 0.95em;
    }
    .card-params div {
      display: flex; align-items: center;
      gap: 4px;
    }
    /* Media area: 16:9, fill entirely */
    #media-container {
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 */
      position: relative;
      background: #000;
    }
    #media-container video {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      object-fit: cover;   /* cover 去黑边 */
      background: #000;
    }
    /* Description */
    .pet-desc {
      padding: 12px;
      line-height: 1.4;
      font-size: 0.95em;
      background: #222;
    }
  </style>
</head>
<body>

  <div class="card">
    <!-- Name & Rarity -->
    <div class="card-header">
      <div class="pet-name" id="pet-name">—</div>
      <!-- 这里会写成 "Rarity: S" 这样的样式 -->
      <div class="pet-rarity" id="pet-rarity">—</div>
    </div>
    <!-- Params: English only -->
    <div class="card-params">
      <div>❤️ Heart Rate: <span id="heart">—</span></div>
      <div>✋ Touch Dist.: <span id="touch">—</span></div>
      <div>🔊 Sound Lvl: <span id="sound">—</span></div>
    </div>
    <!-- Video container -->
    <div id="media-container"></div>
    <!-- Text description -->
    <div class="pet-desc" id="pet-desc">—</div>
  </div>

  <script>
    // 随机参数
    function randomInt(min,max){
      return Math.floor(Math.random()*(max-min+1))+min;
    }
    function genParams(){
      return {
        heart: randomInt(60,100),
        touch: randomInt(0,50),
        sound: randomInt(0,120)
      };
    }
    function toBit(val,thr){ return val>thr?'1':'0'; }
    function categorize(p){
      return toBit(p.heart,80)
           + toBit(p.touch,25)
           + toBit(p.sound,80)
           + '0';
    }
    function getRarityLetter(code){
      const ones = code.split('').filter(c=>c==='1').length;
      return ['D','C','B','A','S'][ones];
    }
    function getRarityText(code){
      // 返回 "Rarity: S" 这种格式
      return 'Rarity: ' + getRarityLetter(code);
    }

    // 16 类映射，只用 b.mp4
    const PET_MAP = {
      "0000":{src:"media/calm_friendly_relaxed_cautious/b.mp4", name:"Gentle Jelly",   desc:"Floating calmly with soft motions."},
      "0001":{src:"media/calm_friendly_relaxed_loving/b.mp4",  name:"Cuddly Whale",   desc:"Close and purring gently."},
      "0010":{src:"media/calm_friendly_alert_cautious/b.mp4",  name:"Alert Jelly",    desc:"Relaxed yet ever watchful."},
      "0011":{src:"media/calm_friendly_alert_loving/b.mp4",   name:"Watchful Whale", desc:"Alert but seeking company."},
      "0100":{src:"media/calm_reserved_relaxed_cautious/b.mp4",name:"Reserved Jelly", desc:"Keeps distance, quietly observing."},
      "0101":{src:"media/calm_reserved_relaxed_loving/b.mp4", name:"Hesitant Heart", desc:"Tentatively trusts yet cautious."},
      "0110":{src:"media/calm_reserved_alert_cautious/b.mp4", name:"Guarded Jelly",  desc:"Externally calm, internally vigilant."},
      "0111":{src:"media/calm_reserved_alert_loving/b.mp4",  name:"Torn Tide",      desc:"Caught between caution and affection."},
      "1000":{src:"media/excited_friendly_relaxed_cautious/b.mp4",name:"Bouncy Jelly",  desc:"Energetic bounce with a hint of caution."},
      "1001":{src:"media/excited_friendly_relaxed_loving/b.mp4", name:"Glowing Gem",   desc:"Radiant energy and gentle fondness."},
      "1010":{src:"media/excited_friendly_alert_cautious/b.mp4", name:"Brave Guardian",desc:"Excited protector, always alert."},
      "1011":{src:"media/excited_friendly_alert_loving/b.mp4",  name:"Fiery Embrace", desc:"Passion and vigilance intertwined."},
      "1100":{src:"media/excited_reserved_relaxed_cautious/b.mp4",name:"Starlit Jelly", desc:"Vibrant yet respectfully distant."},
      "1101":{src:"media/excited_reserved_relaxed_loving/b.mp4", name:"Shy Spark",     desc:"Quiet affection under a bright glow."},
      "1110":{src:"media/excited_reserved_alert_cautious/b.mp4", name:"Cautious Blaze",desc:"Blazing energy held in check."},
      "1111":{src:"media/excited_reserved_alert_loving/b.mp4",  name:"Ultimate Bond", desc:"Love, energy, and vigilance as one."}
    };

    function renderCard(){
      const p   = genParams();
      const cat = categorize(p);
      const pet = PET_MAP[cat];
      if(!pet){ console.error("Missing category",cat); return; }

      // 填参数
      document.getElementById('heart').textContent = p.heart;
      document.getElementById('touch').textContent = p.touch;
      document.getElementById('sound').textContent = p.sound;

      // 填name
      document.getElementById('pet-name').textContent   = pet.name;
      // 填稀有度文字
      document.getElementById('pet-rarity').textContent = getRarityText(cat);
      // 填描述
      document.getElementById('pet-desc').textContent   = pet.desc;

      // 播放video
      const ctr = document.getElementById('media-container');
      ctr.innerHTML = '';
      const v = document.createElement('video');
      v.src         = pet.src;
      v.autoplay    = true;
      v.loop        = true;
      v.muted       = true;
      v.preload     = 'auto';
      v.playsInline = true;
      v.setAttribute('playsinline','');
      v.addEventListener('loadedmetadata',()=>v.play().catch(()=>{}));
      ctr.appendChild(v);
    }

    // 初次渲染
    renderCard();
  </script>
</body>
</html>
